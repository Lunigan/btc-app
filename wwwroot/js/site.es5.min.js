"use strict";function getLatestTimeStamp(){return $("#btc-rates .btc-record-timestamp").last().html()}function convertToISO(n){var r=n.split("."),t=_slicedToArray(r,3),u=t[0],f=t[1],e=t[2],o=e.split(" "),i=_slicedToArray(o,2),s=i[0],h=i[1];return s+"-"+f+"-"+u+"T"+h}function ShowResultModal(n,t,i){var r=$("#resultModal");if(i?r.find(".msg-label").html(n):r.find(".msg-label").text(n),t)r.modal("show").on("hidden.bs.modal",t);else r.modal("show")}var _slicedToArray=function(){function n(n,t){var r=[],u=!0,f=!1,e=undefined,i,o;try{for(i=n[Symbol.iterator]();!(u=(o=i.next()).done);u=!0)if(r.push(o.value),t&&r.length===t)break}catch(s){f=!0;e=s}finally{try{!u&&i["return"]&&i["return"]()}finally{if(f)throw e;}}return r}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),ctx;window.chartLabels&&window.chartData&&(ctx=document.getElementById("btcCzkChart").getContext("2d"),new Chart(ctx,{type:"line",data:{labels:window.chartLabels,datasets:[{label:"BTC/CZK",data:window.chartData,borderColor:"rgba(255, 0, 0, 1)",backgroundColor:"rgba(255, 0, 0, 0.2)",fill:!0,tension:.3}]}}));$("#select-all").on("change",function(){var n=$(this).is(":checked");$(".row-check").prop("checked",n)});$("#delete-selected").on("click",function(){var n=$(".row-check:checked").map(function(){return $(this).data("id")}).get();if(n.length<1){ShowResultModal("Nevybrali jste žádné záznamy.");return}$.ajax({type:"POST",url:"/api/data/delete-many",contentType:"application/json",data:JSON.stringify(n),success:function(){location.reload()},error:function(){ShowResultModal("Chyba při mazání záznamů.")}})});$(".btc-record-save").on("click",function(){if($note=$(this).parent().parent().find("input"),$noteVal="",$note.length>0&&!$note.val()&&!$note[0].checkValidity()){$note[0].reportValidity();return}$note&&$note.val()&&($noteVal=$note.val());var n={timestamp:convertToISO($(this).data("timestamp")),instrument:$(this).data("instrument"),btcEurPrice:$(this).data("btceur").toString().replace(",","."),eur2Czk:$(this).data("eurczk").toString().replace(",","."),note:$noteVal};$(this).data("id")&&(n.id=$(this).data("id"));$.ajax({type:"POST",url:"/api/data/save",data:JSON.stringify(n),contentType:"application/json",success:function(){ShowResultModal("Snapshot BTC kurzu byl úspěšně uložen.")}})});$(document).ready(function(){$("#btc-rates-snapshots").DataTable({select:!0,columnDefs:[{targets:[2,5],orderable:!1}]});$("#btc-rates")&&setInterval(function(){console.log("check for updates");var n=getLatestTimeStamp();$.post("/api/data/latest/check",{lastTimestamp:n},function(n){console.warn(n);n&&(console.log("new content!!!"),location.reload())})},3e4)});